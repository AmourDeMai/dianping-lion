<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="RegisterPoint">
	<typeAlias alias="RegisterPoint" type="com.dianping.lion.entity.RegisterPoint" />
	<typeAlias alias="ConfigSnapshot" type="com.dianping.lion.entity.ConfigSnapshot" />

	<resultMap id="RegisterPointResult" class="RegisterPoint">
		<result column="id" property="id"/>
		<result column="projectId" property="projectId"/>
		<result column="envId" property="envId"/>
		<result column="executeTime" property="executeTime"/>
		<result column="executorId" property="executorId"/>
		<result column="valid" property="valid"/>
		<result column="manual" property="manual"/>
	</resultMap>
	
    <insert id="insertPoint" parameterClass="RegisterPoint">
    	<![CDATA[
    	INSERT INTO register_point(projectId, envId, executeTime, executorId, valid, manual) 
    	VALUES(#projectId#, #envId#, NOW(), #executorId#, #valid#, #manual#)
		]]>
    	<selectKey resultClass="int">
             <![CDATA[SELECT LAST_INSERT_ID() AS ID]]>
        </selectKey>
    </insert>
    
    <insert id="insertConfigSnapshot" parameterClass="ConfigSnapshot">
    	<![CDATA[
    	INSERT INTO config_snapshot(registPointId, `delete`, projectId, `key`, `desc`, type, createUserId, modifyUserId, createTime, modifyTime, seq) 
    	VALUES(#registPointId#, #delete#, #projectId#, #key#, #desc#, #type#, #createUserId#, #modifyUserId#, #createTime#, #modifyTime#, #seq#)
		]]>
    	<selectKey resultClass="int">
             <![CDATA[SELECT LAST_INSERT_ID() AS ID]]>
        </selectKey>
    </insert>
    
    <insert id="insertConfigInstSnapshots" parameterClass="list">
    	INSERT INTO config_instance_snapshot(configSnapshotId, envId, `desc`, value, context, contextmd5, createUserId, modifyUserId, createTime, modifyTime, seq) 
    	VALUES
    	<iterate conjunction=",">
    	(#[].configId#, #[].envId#, #[].desc#, #[].value#, #[].context#, #[].contextmd5#, #[].createUserId#, #[].modifyUserId#, #[].createTime#, #[].modifyTime#, #[].seq#)
    	</iterate>
    </insert>
    
</sqlMap>